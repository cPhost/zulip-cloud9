#!/usr/bin/env node

const yargs = require('yargs');

const args = process.argv.splice(2);
const passedArgs = args.join(' ').split('--')[1];

function startCommand(argv) {
  const devServer = require('../lib/dev-server');

  argv.passedArgs = passedArgs;
  devServer(argv);
}

function startServicesCommand() {
  const startServices = require('../lib/start-services');
  startServices({});
}

yargs(args)
  .command({
    command: 'start',
    desc: 'Start zulip-dev server on http://0.0.0.0',
    builder: (yargs) => {
      yargs
        .option('zulip-path', {
          alias: 'z',
          demandOption: false,
          describe: 'Path to zulip server if not on top-level workspace folder',
          type: 'string'
        });
    },
    handler: startCommand
  })
  .command({
    command: 'start-services',
    desc: 'Start all the required services for zulip.',
    handler: startServicesCommand
  })
  .detectLocale(false)
  .demandCommand(1, 'You must specify start or start-services')
  .help()
  .alias('help', 'h')
  .argv;
